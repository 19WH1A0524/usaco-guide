---
id: usaco-743
source: USACO Silver 2017 Open
title: Modern Art 2
authors: Sofia Yang, William Yuan
---

[Official Analysis (C++)](http://www.usaco.org/current/data/sol_art2_gold_open17.html)

<LanguageSection>
<JavaSection>

### Implementation

**Time Complexity:** $\mathcal{O}(N)$

```java
import java.io.*;
import java.util.*;

public class ModernArt2 {
	public static void main(String[] args) throws IOException {
		BufferedReader in = new BufferedReader(new FileReader("art2.in"));
		PrintWriter out = new PrintWriter(new FileWriter("art2.out"));
		int N = Integer.parseInt(in.readLine());
		int[] start = new int[N + 1];
		int[] end = new int[N + 1];
		Arrays.fill(start, Integer.MAX_VALUE);
		Arrays.fill(end, Integer.MIN_VALUE);

		int[] color = new int[N + 1];
		for (int i = 1; i <= N; i++) {
			color[i] = Integer.parseInt(in.readLine());
		}

		for (int i = 1; i <= N; i++) {
			// Update the first and last appearance of the color.
			start[color[i]] = Integer.min(start[color[i]], i);
			end[color[i]] = Integer.max(end[color[i]], i);
		}

		start[0] = 0;
		end[0] = N + 1;
		int ans = 0;
		// The contents of the stack are the colors of the currently open
		// segments.
		Stack<Integer> stack = new Stack<>();
		for (int idx = 0; idx <= N; idx++) {
			int curColor = color[idx];

			// Process the start point of the color segment.
			if (idx == start[curColor]) {
				stack.push(curColor);
				ans = Integer.max(ans, stack.size());
			}

			/*
			 * Invalid because there are 2 partially intersecting segments.
			 * For instance if we have a finished painting of 1 1 2 1 2,
			 * it is impossible if we can only paint 1 once.
			 */
			if (stack.get(stack.size() - 1) != curColor) {
				out.println(-1);
				out.close();
				System.exit(0);
			}

			// Remove the color from the stack since the segment has closed.
			if (idx == end[curColor]) { stack.pop(); }
		}

		// Subtract the color '0' segment.
		out.println(ans - 1);
		out.close();
	}
}
```
</JavaSection>


<CPPSection>

### Implementation

**Time Complexity:** $\mathcal{O}(N)$

```cpp
#include <bits/stdc++.h>
using namespace std;
const int mx = 1e5 + 5;
int col[mx], start[mx], fin[mx], n, ans = 0;

int main() {
	ios::sync_with_stdio(false);
	cin.tie(nullptr);
	freopen("art2.in", "r", stdin);
	freopen("art2.out", "w", stdout);
	fill(start, start + mx, 1 << 30);
	fill(fin, fin + mx, -(1 << 30));
	cin >> n;

	// get start, end points
	for (int i = 1; i <= n; i++) {
		cin >> col[i];
		start[col[i]] = min(start[col[i]], i);
		fin[col[i]] = max(fin[col[i]], i);
	}

	start[0] = 0, fin[0] = n + 1;
	stack<int> active;  // keep track of segments

	for (int i = 0; i <= n; i++) {
		int cur = col[i];
		// insert color at start
		if (i == start[col[i]]) {
			active.emplace(col[i]);
			ans = max(ans, (int)active.size());
		}

		// check for partial intersections
		// for example, in painting [1, 1, 2, 1, 2]
		// color 1 has start, end at 1, 4
		// color 2 has start, end at 3, 5
		// it is impossible to interweave them
		// since both colors are used only once
		// to paint a segment of the painting
		// thus, the painting is invalid
		if (cur != active.top()) {
			cout << "-1\n";
			return 0;
		}

		// remove color at end
		if (i == fin[col[i]]) active.pop();
	}

	// '0' is not a color.
	cout << ans - 1 << "\n";
}
```
</CPPSection>

</LanguageSection>
