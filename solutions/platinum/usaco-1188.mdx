---
id: usaco-1188
source: USACO Platinum 2022 January
title: Minimizing Haybales
author: Aakash Gokhale
---

[External Solution](http://www.usaco.org/current/data/sol_prob1_platinum_jan22.html)

## Solution

<LanguageSection>

<CPPSection>
```cpp
#include <bits/stdc++.h>
using namespace std;

int n, k;

struct Block {
	int hi, lo;
	vector<int> vals;
	Block() {
		hi = -1e9;
		lo = 1e9;
	}
	Block(vector<int> a) {
		hi = -1e9;
		lo = 1e9;
		for (auto &i : a) {
			vals.push_back(i);
			hi = max(hi, i);
			lo = min(lo, i);
		}
	}
	void add(int x) {
		lo = min(lo, x);
		hi = max(hi, x);
		vals.push_back(x);
		int i = vals.size() - 1;
		while (i > 0 && abs(vals[i] - vals[i - 1]) <= k) {
			swap(vals[i], vals[i - 1]);
			i--;
		}
		while (i < vals.size() - 1 && vals[i] > vals[i + 1]) {
			swap(vals[i], vals[i + 1]);
			i++;
		}
	}
	bool reaches_end(int x) {
		vals.push_back(x);
		int i = vals.size() - 1;
		while (i > 0 && abs(vals[i] - vals[i - 1]) <= k) {
			swap(vals[i], vals[i - 1]);
			i--;
		}
		while (i < vals.size() - 1 && vals[i] > vals[i + 1]) {
			swap(vals[i], vals[i + 1]);
			i++;
		}
		bool ans = vals.back() == x;
		vals.erase(begin(vals) + i);
		return ans;
	}
};

int main() {
	ios::sync_with_stdio(0);
	cin.tie(0);
	cin >> n >> k;
	int len = (int)floor(sqrt(n));
	vector<Block> sqrt{Block()};
	for (int i = 0; i < n; i++) {
		int x;
		cin >> x;
		int j = sqrt.size() - 1;
		while (j > 0 && (x + k >= sqrt[j].hi && x - k <= sqrt[j].lo)) { j--; }
		if (j < sqrt.size() - 1 && sqrt[j].reaches_end(x)) {
			j++;
			while (j < sqrt.size() - 1 && x >= sqrt[j].hi) { j++; }
		}
		sqrt[j].add(x);
		if (sqrt[j].vals.size() > len) {
			int half = (sqrt[j].vals.size()) / 2;
			vector<int> left, right;
			for (int k = 0; k < half; k++) { left.push_back(sqrt[j].vals[k]); }
			for (int k = half; k < sqrt[j].vals.size(); k++) {
				right.push_back(sqrt[j].vals[k]);
			}
			sqrt.insert(begin(sqrt) + j, Block(left));
			sqrt[j + 1] = Block(right);
		}
	}
	for (auto block : sqrt) {
		for (auto num : block.vals) { cout << num << endl; }
	}
}
```

</CPPSection>

</LanguageSection>
