---
id: usaco-1233
source: USACO Gold 2022 Open
title: Apple Catching
author: Qi Wang
---

[Official Analysis (Java)](http://www.usaco.org/current/data/sol_prob1_gold_open22.html)

## Implementation

**Time Complexity:** $\mathcal{O}(N \log N)$

<LanguageSection>

<CPPSection>

```cpp
#include <bits/stdc++.h>

using namespace std;


struct item {
	int q, t, x, n;

	// expand out inequality into 2D space
	bool operator<(const item& y) {
		if (x - t == y.x - y.t)
			return q > y.q;

		return x - t < y.x - y.t;
	}
} p[200005];


int main() {
	int N, ans = 0;
	map<int, int> mpp;
	cin >> N;
	for(int i = 0; i < N; i++){
		cin >> p[i].q >> p[i].t >> p[i].x >> p[i].n;
	}

	sort(p, p + N);

	for(int i = 0; i < N; i++) {
		if (p[i].q == 2) {
			mpp[p[i].x + p[i].t] += p[i].n;
		}
		else {
			int n = p[i].n;
			// greedily assign cows to the closest points
			while (n) {
				map<int, int>::iterator it = mpp.lower_bound(p[i].x + p[i].t);

				if (it == mpp.end()) break;
				int u = min(n, it->second);

				if (u == it->second) {
					mpp.erase(it);
				}
				else {
					it->second -= u;
				}

				n -= u;
				ans += u;
			}
		}
	}

	cout << ans << endl;
}
```

</CPPSection>

</LanguageSection>